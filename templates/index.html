
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Insurance Fraud Detection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        .dark {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .dark .bg-white {
            background-color: #2d3748;
        }
        .dark .border-gray-200 {
            border-color: #4a5568;
        }
    </style>
</head>
<body class="bg-gray-50 transition-colors duration-300">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-6">
                    <div class="flex items-center">
                        <h1 class="text-3xl font-bold text-gray-900">üïµÔ∏è Insurance Fraud Detection</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="themeToggle" class="p-2 rounded-md hover:bg-gray-100 transition-colors">
                            <span id="themeIcon">üåô</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Description -->
            <div class="bg-white rounded-lg shadow p-6 mb-8 border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-900 mb-3">ü§ñ AI-Powered Fraud Detection</h2>
                <p class="text-gray-600">
                    Upload insurance claim images to detect potential fraud using advanced computer vision and machine learning algorithms. 
                    Our AI analyzes images for tampering, duplicates, metadata inconsistencies, and suspicious patterns to provide 
                    fraud likelihood scores and actionable recommendations.
                </p>
            </div>

            <!-- Stats Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="text-3xl">üìä</div>
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <dl>
                                <dt class="text-sm font-medium text-gray-500 truncate">Total Claims Analyzed</dt>
                                <dd class="text-3xl font-bold text-gray-900" id="totalClaims">{{ stats.total_claims }}</dd>
                            </dl>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="text-3xl">‚ö†Ô∏è</div>
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <dl>
                                <dt class="text-sm font-medium text-gray-500 truncate">Fraud Detection Rate</dt>
                                <dd class="text-3xl font-bold text-red-600" id="fraudRatio">{{ stats.fraud_ratio }}%</dd>
                            </dl>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="text-3xl">üéØ</div>
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <dl>
                                <dt class="text-sm font-medium text-gray-500 truncate">AI Accuracy</dt>
                                <dd class="text-3xl font-bold text-green-600">94.7%</dd>
                            </dl>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Image Upload Section -->
                <div class="bg-white rounded-lg shadow border border-gray-200">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">üñºÔ∏è Upload Claim Image</h3>
                    </div>
                    <div class="p-6">
                        <div id="dropZone" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors cursor-pointer">
                            <div class="space-y-4">
                                <div class="text-4xl">üìÅ</div>
                                <div>
                                    <p class="text-lg font-medium text-gray-900">Drop your image here</p>
                                    <p class="text-sm text-gray-500">or click to browse (PNG, JPG, JPEG)</p>
                                </div>
                                <input type="file" id="fileInput" accept=".png,.jpg,.jpeg" class="hidden">
                            </div>
                        </div>
                        
                        <div id="uploadProgress" class="mt-4 hidden">
                            <div class="bg-blue-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analysis Results -->
                <div class="bg-white rounded-lg shadow border border-gray-200">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">üîç Analysis Results</h3>
                    </div>
                    <div class="p-6">
                        <div id="analysisResults" class="text-center text-gray-500">
                            Upload an image to see fraud detection results
                        </div>
                    </div>
                </div>
            </div>

            <!-- Image Analysis Viewer -->
            <div id="imageViewer" class="mt-8 bg-white rounded-lg shadow border border-gray-200 hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">üñºÔ∏è Image Analysis Viewer</h3>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-sm font-medium text-gray-900 mb-2">Original Image</h4>
                            <img id="originalImage" class="w-full rounded-lg border border-gray-200" />
                        </div>
                        <div>
                            <h4 class="text-sm font-medium text-gray-900 mb-2">Fraud Analysis</h4>
                            <div id="fraudAnalysis" class="space-y-4">
                                <!-- Analysis details will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Claims -->
            <div class="mt-8 bg-white rounded-lg shadow border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">üìã Recent Claims</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Filename</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fraud Score</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Recommendation</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="recentClaimsTable">
                            {% for claim in stats.recent_claims %}
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ claim[1] }}</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full 
                                        {% if claim[3] < 30 %}bg-green-100 text-green-800
                                        {% elif claim[3] < 70 %}bg-yellow-100 text-yellow-800
                                        {% else %}bg-red-100 text-red-800{% endif %}">
                                        {{ claim[3] }}%
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                                        {% if claim[6] == 'APPROVE' %}bg-green-100 text-green-800
                                        {% elif claim[6] == 'REVIEW' %}bg-yellow-100 text-yellow-800
                                        {% else %}bg-red-100 text-red-800{% endif %}">
                                        {{ claim[6] }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ claim[5][:10] }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <a href="/generate_report/{{ claim[0] }}" class="text-blue-600 hover:text-blue-900">üìÑ Report</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const body = document.body;

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark');
            themeIcon.textContent = body.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
        });

        // File upload functionality
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const uploadProgress = document.getElementById('uploadProgress');
        const analysisResults = document.getElementById('analysisResults');
        const imageViewer = document.getElementById('imageViewer');

        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-blue-400');
        });
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('border-blue-400');
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-blue-400');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        function handleFileUpload(file) {
            const formData = new FormData();
            formData.append('file', file);

            uploadProgress.classList.remove('hidden');
            const progressBar = uploadProgress.querySelector('.bg-blue-600');
            progressBar.style.width = '30%';

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                progressBar.style.width = '100%';
                setTimeout(() => {
                    uploadProgress.classList.add('hidden');
                    progressBar.style.width = '0%';
                    displayResults(data);
                }, 500);
            })
            .catch(error => {
                console.error('Error:', error);
                uploadProgress.classList.add('hidden');
                analysisResults.innerHTML = '<p class="text-red-600">Error analyzing image</p>';
            });
        }

        function displayResults(data) {
            if (data.error) {
                analysisResults.innerHTML = `<p class="text-red-600">${data.error}</p>`;
                return;
            }

            const fraudScore = data.fraud_score;
            const recommendation = data.recommendation;
            const scoreColor = fraudScore < 30 ? 'text-green-600' : fraudScore < 70 ? 'text-yellow-600' : 'text-red-600';
            const recColor = recommendation === 'APPROVE' ? 'bg-green-100 text-green-800' : 
                            recommendation === 'REVIEW' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';

            analysisResults.innerHTML = `
                <div class="space-y-4">
                    <div class="text-center">
                        <div class="text-4xl font-bold ${scoreColor}">${fraudScore}%</div>
                        <div class="text-sm text-gray-500">Fraud Likelihood</div>
                    </div>
                    <div class="text-center">
                        <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full ${recColor}">
                            ${recommendation}
                        </span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>Duplicate Check:</span>
                            <span class="${data.analysis_results.is_duplicate ? 'text-red-600' : 'text-green-600'}">
                                ${data.analysis_results.is_duplicate ? '‚ùå Duplicate Found' : '‚úÖ Unique'}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span>Tampering Score:</span>
                            <span class="text-gray-600">${(data.analysis_results.tampering_score * 100).toFixed(1)}%</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Metadata Issues:</span>
                            <span class="text-gray-600">${data.analysis_results.metadata_issues}</span>
                        </div>
                    </div>
                </div>
            `;

            // Display image
            const originalImage = document.getElementById('originalImage');
            originalImage.src = `data:image/jpeg;base64,${data.image_data}`;
            imageViewer.classList.remove('hidden');

            // Update fraud analysis section
            const fraudAnalysis = document.getElementById('fraudAnalysis');
            fraudAnalysis.innerHTML = `
                <div class="bg-gray-50 rounded-lg p-4">
                    <h5 class="font-medium text-gray-900 mb-2">Fraud Analysis Summary</h5>
                    <div class="space-y-2 text-sm text-gray-600">
                        <p>‚Ä¢ Image processed using AI-powered fraud detection</p>
                        <p>‚Ä¢ ${data.analysis_results.suspicious_regions.length} suspicious regions identified</p>
                        <p>‚Ä¢ Metadata analysis: ${Object.keys(data.metadata).length} fields extracted</p>
                        <p>‚Ä¢ Cross-referenced with ${data.analysis_results.is_duplicate ? 'existing' : 'no'} duplicate claims</p>
                    </div>
                </div>
                <div class="bg-blue-50 rounded-lg p-4">
                    <h5 class="font-medium text-blue-900 mb-2">AI Recommendation</h5>
                    <p class="text-sm text-blue-700">
                        Based on the analysis, this claim should be <strong>${recommendation}</strong>. 
                        ${recommendation === 'APPROVE' ? 'Low fraud indicators detected.' : 
                          recommendation === 'REVIEW' ? 'Moderate fraud indicators require human review.' : 
                          'High fraud indicators detected - recommend rejection.'}
                    </p>
                </div>
            `;

            // Refresh page to update recent claims
            setTimeout(() => location.reload(), 2000);
        }
    </script>
</body>
</html>
